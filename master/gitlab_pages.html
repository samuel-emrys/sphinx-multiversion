
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Hosting on GitLab Pages &#8212; sphinx-multiversion 0.2.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Hosting on GitHub Pages" href="github_pages.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="hosting-on-gitlab-pages">
<span id="gitlab-pages"></span><h1>Hosting on GitLab Pages<a class="headerlink" href="#hosting-on-gitlab-pages" title="Permalink to this headline">¶</a></h1>
<p>You use <a class="reference external" href="_gitlab_pages_website">GitLab Pages</a> to host documentation generated by <code class="docutils literal notranslate"><span class="pre">sphinx-multiversion</span></code>.</p>
<section id="configure-your-project">
<h2>Configure your project<a class="headerlink" href="#configure-your-project" title="Permalink to this headline">¶</a></h2>
<p>Because of the way GitLab checks out a repository when running a CI task, you’ll need to whitelist remote branches in your <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">smv_remote_whitelist</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^(origin)$&#39;</span>
</pre></div>
</div>
<p>If this is not specified, <code class="docutils literal notranslate"><span class="pre">sphinx-multiversion</span></code> will only be able to generate documentation for whitelisted tag patterns.</p>
</section>
<section id="create-gitlab-ci-yml">
<h2>Create <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code><a class="headerlink" href="#create-gitlab-ci-yml" title="Permalink to this headline">¶</a></h2>
<p>GitLab pages always deploys your website from a specific folder called <code class="docutils literal notranslate"><span class="pre">public</span></code> in your repository. To deploy to your site, GitLab pages uses its built in continuous integration tools to build your site and publish it to the GitLab server. To accomplish this, you need to create a <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> in your repository. This recipe will build your documentation, move it to a folder named <code class="docutils literal notranslate"><span class="pre">public</span></code>, and then create an artifact compressing this folder. Populate it as follows.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:latest</span><span class="w"></span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span><span class="w"></span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt update -y</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt install -y texlive latexmk texlive-latex-extra</span><span class="w"> </span><span class="c1"># only necessary for pdf generation</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span><span class="w"></span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sphinx-multiversion docs/source/ public</span><span class="w"></span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span><span class="w"> </span><span class="c1"># may need removal depending on what available GitLab runners are tagged with</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span><span class="w"></span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">branches</span><span class="w"></span>
<span class="w">  </span><span class="nt">except</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span><span class="w"></span>

<span class="nt">pages</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:latest</span><span class="w"></span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="w"></span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt update -y</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt install -y texlive latexmk texlive-latex-extra</span><span class="w"> </span><span class="c1"># only necessary for pdf generation</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span><span class="w"></span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sphinx-multiversion docs/source public</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"> </span><span class="c1"># Add index.html to public root to redirect to $CI_DEFUALT_BRANCH/index.html</span><span class="w"></span>
<span class="w">      </span><span class="no">cat &gt;public/index.html &lt;&lt; EOF</span><span class="w"></span>
<span class="w">      </span><span class="no">&lt;!DOCTYPE html&gt;</span><span class="w"></span>
<span class="w">        </span><span class="no">&lt;html&gt;</span><span class="w"></span>
<span class="w">          </span><span class="no">&lt;head&gt;</span><span class="w"></span>
<span class="w">            </span><span class="no">&lt;title&gt;Redirecting to $CI_DEFAULT_BRANCH branch&lt;/title&gt;</span><span class="w"></span>
<span class="w">            </span><span class="no">&lt;meta charset=&quot;utf-8&quot;&gt;</span><span class="w"></span>
<span class="w">            </span><span class="no">&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=./$CI_DEFAULT_BRANCH/index.html&quot;&gt;</span><span class="w"></span>
<span class="w">            </span><span class="no">&lt;link rel=&quot;canonical&quot; href=&quot;$CI_PAGES_URL/$CI_DEFAULT_BRANCH/index.html&quot;&gt;</span><span class="w"></span>
<span class="w">          </span><span class="no">&lt;/head&gt;</span><span class="w"></span>
<span class="w">        </span><span class="no">&lt;/html&gt;</span><span class="w"></span>
<span class="w">      </span><span class="no">EOF</span><span class="w"></span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span><span class="w"> </span><span class="c1"># may need removal depending on what available GitLab runners are tagged with</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span><span class="w"></span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public</span><span class="w"></span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span><span class="w"></span>
</pre></div>
</div>
<p>This will create two jobs. The first job will test that documentation generation will complete successfully. This will run for every branch with the exception of <code class="docutils literal notranslate"><span class="pre">master</span></code>. The second task will deploy the generated documents to the GitLab pages server. This task will run only on changes to the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch. These rules should be updated to reflect your desired behaviour. Note that this includes the addition of a dummy <code class="file docutils literal notranslate"><span class="pre">index.html</span></code> to the root of your GitLab <code class="docutils literal notranslate"><span class="pre">public</span></code> directory that redirects to documentation on the <code class="docutils literal notranslate"><span class="pre">$CI_DEFAULT_BRANCH</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>A list of predefined environment variables available for use in <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> is available in the <a class="reference external" href="_gitlab_predefined_variables">GitLab Predefined variables reference</a>.</p>
</div>
<p>For deployments to <code class="docutils literal notranslate"><span class="pre">.gitlab.com</span></code>, the default domain for GitLab pages websites is <code class="docutils literal notranslate"><span class="pre">*.gitlab.io</span></code>. Your documentation should be available at <code class="docutils literal notranslate"><span class="pre">https://username.gitlab.io/reponame</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For details, please have a look at the <a class="reference external" href="_gitlab_pages_tutorial">GitLab Pages Documentation</a>.</p>
</div>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="github_pages.html" title="Previous document">Hosting on GitHub Pages</a>
        </li>
        <li>
          <a href="faq.html" title="Next document">Frequently Asked Questions</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">sphinx-multiversion</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Holzhaus&repo=sphinx-multiversion&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/Holzhaus/sphinx-multiversion">
    <img
        alt="https://secure.travis-ci.org/Holzhaus/sphinx-multiversion.svg?branch=master"
        src="https://secure.travis-ci.org/Holzhaus/sphinx-multiversion.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="context.html">HTML Context</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="github_pages.html">Hosting on GitHub Pages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hosting on GitLab Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="github_pages.html" title="previous chapter">Hosting on GitHub Pages</a></li>
      <li>Next: <a href="faq.html" title="next chapter">Frequently Asked Questions</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h3>Branches</h3>
<ul>
  <li><a href="gitlab_pages.html">master</a></li>
</ul>
<h3>Tags</h3>
<ul>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Jan Holthuis.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/gitlab_pages.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/Holzhaus/sphinx-multiversion" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>